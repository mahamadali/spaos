{"version":3,"file":"/modules/category/category-form.js","mappings":"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","sources":["webpack:///./Modules/Category/Resources/assets/js/category-form.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", function () {\n\n  const offcanvasEl = document.getElementById(\"categoryOffcanvas\");\n  if (!offcanvasEl) {\n    console.error(\"Category offcanvas element not found\");\n    return;\n  }\n  \n  const offcanvas = new bootstrap.Offcanvas(offcanvasEl);\n  const form = document.getElementById(\"category-form\");\n  if (!form) {\n    console.error(\"Category form element not found\");\n    return;\n  }\n  \n  // The form wraps the offcanvas, so formEl is the same as form\n  const formEl = form;\n  \n  const nameInput = document.getElementById(\"name\");\n  const parentInput = document.getElementById(\"parent_id\");\n  const baseUrl = document.querySelector('meta[name=\"baseUrl\"]')?.getAttribute('content');\n  if (!baseUrl) {\n    console.error(\"Base URL meta tag not found\");\n    return;\n  }\n  \n  const titleEl = offcanvasEl.querySelector('.offcanvas-title'); // <h5>\n  if (!titleEl) {\n    console.error(\"Category offcanvas title element not found\");\n    return;\n  }\n  \n  const parentSelect = document.getElementById(\"parent_id\");\n  const statusInput = document.querySelector('.category-status');\n\n// Initialize Select2 for parent category dropdown\nfunction initializeSelect2() {\n  if ($('#parent_id').length && !$('#parent_id').hasClass('select2-hidden-accessible')) {\n    $('#parent_id').select2({\n      placeholder: \"Select Category\",\n      allowClear: false, // This disables the clear \"x\" icon\n      width: '100%',\n      minimumResultsForSearch: Infinity // This disables the search box\n    }).on('change', function() {\n      // Clear error when category is selected\n      const parentVal = $(this).val();\n      const element = $(this)[0]; // Get the actual DOM element\n      if (parentVal && element) {\n        clearError(element);\n      }\n    });\n  }\n}\n\n// Initialize on page load\ninitializeSelect2();\n\n  offcanvasEl.addEventListener('show.bs.offcanvas', function (event) {\n    const triggerButton = event.relatedTarget;\n\n    if (triggerButton && triggerButton.matches('[data-bs-target=\"#categoryOffcanvas\"]')) {\n      // Safety check: ensure formEl exists\n      if (!formEl) {\n        console.error(\"Category form element not found in offcanvas show event\");\n        return;\n      }\n\n      const type = triggerButton.dataset.type;\n      if (titleEl) {\n        titleEl.textContent = type === \"subcategory\" ? \"New Subcategory\" : \"New Category\";\n      }\n\n      formEl.reset();\n      const nameInput = formEl.querySelector('#name');\n      if (nameInput) nameInput.value = '';\n\n      const statusInput = formEl.querySelector('#status');\n      if (statusInput) statusInput.checked = true;\n\n      if (formEl) {\n        formEl.querySelectorAll('.fields-error').forEach(el => {\n          el.textContent = '';\n          el.classList.add('d-none');\n        });\n      }\n\n      const imgPreview = formEl.querySelector('.upload-image-box img');\n      const removeBtn = form ? form.querySelector('.upload-image-box button.btn-danger') : null;\n\n      if (imgPreview) {\n          imgPreview.src = imgPreview.dataset.defaultSrc;\n          if (removeBtn) {\n            removeBtn.style.display = 'none';\n          }\n      }\n\n      const methodInput = formEl.querySelector('input[name=\"_method\"]');\n      if (methodInput) methodInput.remove();\n\n      if (formEl) {\n        formEl.querySelectorAll('select').forEach(select => {\n          select.value = '';\n          if ($(select).hasClass('select2')) {\n            $(select).val('').trigger('change');\n          }\n        });\n      }\n\n      // Re-initialize Select2 after form reset\n      setTimeout(() => {\n        initializeSelect2();\n      }, 100);\n\n      formEl.action = `${baseUrl}/app/categories`;\n      // Also update the main form variable for consistency\n      if (form) {\n        form.action = formEl.action;\n      }\n    }\n  });\n\n  document.addEventListener(\"click\", function (e) {\n    const categorybtn = e.target.closest(\"[data-category-id]\");\n    const subcategorybtn = e.target.closest(\"[data-subcategory-id]\");\n\n    if (!categorybtn && !subcategorybtn) return;\n\n    // Safety check: ensure formEl exists\n    if (!formEl) {\n      console.error(\"Category form element not found when trying to edit\");\n      return;\n    }\n\n    let categoryId, type;\n    if (categorybtn) {\n      categoryId = categorybtn.dataset.categoryId;\n      type = \"category\";\n    } else {\n      categoryId = subcategorybtn.dataset.subcategoryId;\n      type = \"subcategory\";\n    }\n\n    // Safety check: ensure formEl exists before using it\n    if (!formEl) {\n      console.error(\"Category form element not found when trying to edit\");\n      return;\n    }\n\n    if (formEl) {\n      formEl.querySelectorAll('.fields-error').forEach(el => {\n        el.textContent = '';\n        el.classList.add('d-none');\n      });\n    }\n\n    fetch(`${baseUrl}/app/categories/${categoryId}/edit`, {\n      headers: { \"X-Requested-With\": \"XMLHttpRequest\" }\n    })\n      .then(res => res.json())\n      .then(response => {\n        if (!formEl) {\n          console.error(\"Category form element not found in fetch response handler\");\n          return;\n        }\n\n        if (response.status && response.data) {\n          if (titleEl) {\n            titleEl.textContent = type === \"subcategory\" ? \"Edit Subcategory\" : \"Edit Category\";\n          }\n\n          if (nameInput) {\n            nameInput.value = response.data.name || \"\";\n          }\n\n          if (statusInput) {\n            statusInput.checked = Number(response.data.status) === 1;\n          }\n\n          if(type === \"subcategory\" && parentSelect) {\n            parentSelect.value = response.data.parent_id || \"\";\n              $(parentSelect).trigger('change'); // for Select2 UI\n          }\n\n          formEl.action = `${baseUrl}/app/categories/${categoryId}`;\n\n          // Ensure _method field exists and is set to PUT for updates\n          let methodInput = formEl.querySelector('input[name=\"_method\"]');\n          if (!methodInput) {\n            methodInput = document.createElement('input');\n            methodInput.type = 'hidden';\n            methodInput.name = '_method';\n            formEl.appendChild(methodInput);\n          }\n          methodInput.value = 'PUT';\n          \n          // Also update the main form variable for consistency\n          if (form) {\n            form.action = formEl.action;\n          }\n\n          const featureImageUrl = response.data.feature_image;\n          const imgPreview = form ? form.querySelector('.upload-image-box img') : null;\n          const removeBtn = form ? form.querySelector('.upload-image-box button.btn-danger') : null;\n\n          if (imgPreview) {\n            if (featureImageUrl) {\n              imgPreview.src = featureImageUrl;\n              if (removeBtn) {\n                if (!featureImageUrl.includes('default.png')) {\n                  removeBtn.style.display = 'inline-block';\n                } else {\n                  removeBtn.style.display = 'none';\n                }\n              }\n            } else {\n              imgPreview.src = imgPreview.dataset.defaultSrc; // fallback to default\n              if (removeBtn) {\n                removeBtn.style.display = 'none';\n              }\n            }\n          }\n\n          if (offcanvas) {\n            offcanvas.show();\n          }\n        } else {\n          console.error(\"Unexpected response:\", response);\n        }\n      })\n      .catch(err => console.error(\"Error fetching category:\", err));\n  });\n\n  // Clear errors when user starts entering valid data\n  if (nameInput) {\n    nameInput.addEventListener('input', function() {\n      const nameVal = this.value.trim();\n      if (nameVal) {\n        clearError(this);\n      }\n    });\n\n    nameInput.addEventListener('blur', function() {\n      const specialCharsRegex = /[!@#$%^&*(),.?\":{}|<>\\-_;'\\/+=\\[\\]\\\\]/;\n      const numberRegex = /\\d/;\n      const nameVal = this.value.trim();\n      \n      if (!nameVal) {\n        showError(this, \"Name is a required field\");\n      } else if (specialCharsRegex.test(nameVal) || numberRegex.test(nameVal)) {\n        showError(this, \"Only strings are allowed\");\n      } else {\n        clearError(this);\n      }\n    });\n  }\n\n  if (parentInput) {\n    parentInput.addEventListener('change', function() {\n      const parentVal = this.value.trim();\n      if (parentVal) {\n        clearError(this);\n      }\n    });\n\n    // Also handle Select2 change event\n    if ($(parentInput).length && $(parentInput).hasClass('select2-hidden-accessible')) {\n      $(parentInput).on('change', function() {\n        const parentVal = $(this).val();\n        if (parentVal) {\n          clearError(this[0]);\n        }\n      });\n    }\n  }\n\n  if (form) {\n    form.addEventListener(\"submit\", function (e) {\n      let isValid = true;\n      if (form) {\n        form.querySelectorAll(\".form-group .form-control, .form-group .form-select\")\n          .forEach(input => clearError(input));\n      }\n\n      const specialCharsRegex = /[!@#$%^&*(),.?\":{}|<>\\-_;'\\/+=\\[\\]\\\\]/;\n      const numberRegex = /\\d/;\n\n      if (nameInput) {\n        const nameVal = nameInput.value.trim();\n        if (!nameVal) {\n          showError(nameInput, \"Name is a required field\");\n          isValid = false;\n        } else if (specialCharsRegex.test(nameVal) || numberRegex.test(nameVal)) {\n          showError(nameInput, \"Only strings are allowed\");\n          isValid = false;\n        }\n      }\n\n      if (parentInput) {\n        const parentVal = parentInput.value.trim();\n        if (!parentVal) {\n          showError(parentInput, \"Category is a required field\");\n          isValid = false;\n        }\n      }\n\n      if (!isValid) {\n        e.preventDefault();\n      }\n    });\n  }\n\n  function showError(input, message) {\n    let errorEl = input.closest(\".form-group\").querySelector(\".fields-error\");\n    if (errorEl) {\n      errorEl.textContent = message;\n      errorEl.classList.remove(\"d-none\");\n    }\n  }\n\n  function clearError(input) {\n    const formGroup = input.closest(\".form-group\");\n    if (!formGroup) return;\n    const errorEl = formGroup.querySelector(\".fields-error\");\n    if (errorEl) {\n      errorEl.textContent = \"\";\n      errorEl.classList.add(\"d-none\");\n    }\n  }\n});\n\nwindow.previewImage = function(event) {\n  const reader = new FileReader();\n  reader.onload = function() {\n    const formGroup = event.target.closest('.form-group');\n    const preview = formGroup?.querySelector('img');\n    if (preview) {\n      preview.src = reader.result;\n    }\n    const removeBtn = formGroup?.querySelector('.btn-danger');\n    if (removeBtn) {\n      removeBtn.style.display = 'inline-block';\n    }\n  };\n  reader.readAsDataURL(event.target.files[0]);\n};\n\nwindow.removeImage = function(event) {\n  const formGroup = event.target.closest('.form-group');\n  const preview = formGroup?.querySelector('img');\n  const fileInput = formGroup?.querySelector('input[type=\"file\"]');\n  const removeBtn = event.target;\n\n  if (preview) {\n    preview.src = preview.dataset.defaultSrc; // from data attribute\n  }\n  if (fileInput) {\n    fileInput.value = '';\n  }\n  if (removeBtn) {\n    removeBtn.style.display = 'none';\n  }\n};\n\n"],"names":["document","addEventListener","_document$querySelect","offcanvasEl","getElementById","offcanvas","bootstrap","Offcanvas","form","formEl","nameInput","parentInput","baseUrl","querySelector","getAttribute","titleEl","parentSelect","statusInput","initializeSelect2","event","triggerButton","relatedTarget","matches","console","error","type","dataset","textContent","reset","value","checked","querySelectorAll","forEach","el","classList","add","imgPreview","removeBtn","src","defaultSrc","style","display","methodInput","remove","select","$","hasClass","val","trigger","setTimeout","action","concat","e","categoryId","categorybtn","target","closest","subcategorybtn","subcategoryId","fetch","headers","then","res","json","response","status","data","name","Number","parent_id","createElement","appendChild","featureImageUrl","feature_image","includes","show","err","this","trim","clearError","nameVal","test","showError","length","on","isValid","input","preventDefault","select2","placeholder","allowClear","width","minimumResultsForSearch","Infinity","parentVal","element","message","errorEl","formGroup","window","previewImage","reader","FileReader","onload","preview","result","readAsDataURL","files","removeImage","fileInput"],"sourceRoot":""}