(()=>{document.addEventListener("DOMContentLoaded",(function(){var o=document.getElementById("form-offcanvas");o&&(o.addEventListener("show.bs.offcanvas",(function(){console.log("üîÑ Service offcanvas is opening...")})),o.addEventListener("shown.bs.offcanvas",(function(){console.log("‚úÖ Service offcanvas is now shown"),setTimeout((function(){console.log("‚è±Ô∏è Timeout triggered, checking if elements exist...");var e=document.getElementById("category_id"),o=document.getElementById("sub_category_id");console.log("üîç Elements check after timeout:"),console.log("  - category_id element:",e?"Found":"Not found"),console.log("  - sub_category_id element:",o?"Found":"Not found"),"function"==typeof window.initializeServiceSelect2?(console.log("üîß Calling initializeServiceSelect2..."),window.initializeServiceSelect2()):console.warn("‚ö†Ô∏è initializeServiceSelect2 function not found")}),300);var e=document.getElementById("description"),o=document.getElementById("description-counter");if(e&&o){var t=function(){var t=e.value.length;o.textContent="".concat(t,"/").concat(n)},n=e.getAttribute("maxlength")||250;e.addEventListener("input",t),t()}}))),console.log("service-form.js loaded"),$(document).off("click","[data-service-id]"),$(document).on("click",".edit-service-btn",(function(o){o.preventDefault();var n=this.getAttribute("data-service-id")||this.getAttribute("data-service-id");n&&function(o){console.log("loadEditForm",o),t=o,e.querySelector(".offcanvas-body")?e.querySelector(".offcanvas-body").innerHTML='\n            <div class="text-center">\n                <div class="spinner-border" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n            </div>\n        ':e.innerHTML='\n            <div class="offcanvas-header">\n                <h5 class="offcanvas-title">Loading...</h5>\n                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>\n            </div>\n            <div class="offcanvas-body text-center">\n                <div class="spinner-border" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n            </div>\n        ';var n=(window.ServiceRoutes&&window.ServiceRoutes.editForm?window.ServiceRoutes.editForm:"/app/services/edit-form/__ID__").replace("__ID__",o);fetch(n).then((function(e){return e.text()})).then((function(o){e.innerHTML=o,e.querySelectorAll("script").forEach((function(e){var o=document.createElement("script");Array.from(e.attributes).forEach((function(e){o.setAttribute(e.name,e.value)})),o.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(o,e)})),document.querySelectorAll(".offcanvas-backdrop").forEach((function(e){return e.remove()})),bootstrap.Offcanvas.getOrCreateInstance(e).show(),setTimeout((function(){"function"==typeof initializeServiceSelect2&&initializeServiceSelect2()}),100),console.log("Offcanvas opened with edit form.")})).catch((function(o){console.error("Error loading edit form:",o),e.querySelector(".offcanvas-body")&&(e.querySelector(".offcanvas-body").innerHTML='\n                    <div class="alert alert-danger">Error loading form. Please try again.</div>\n                ')}))}(n)})),document.addEventListener("submit",(function(e){"service-form"!==e.target.id&&"service-edit-form"!==e.target.id||function(e){var o=e.target,t=o.querySelector('button[type="submit"]'),n=t.querySelector(".spinner-border");t.disabled=!0,n&&n.classList.remove("d-none")}(e)}))}));var e=document.querySelector("#form-offcanvas"),o=e.innerHTML,t=null;function n(e){var o=$(e);if(o.length&&o.data("select2"))try{o.select2("destroy")}catch(e){}}document.addEventListener("crud_change_id",(function(n){var c=n.detail.form_id;c!==t&&(t=c,0!==c&&"0"!==c||(e.innerHTML=o,setTimeout((function(){"function"==typeof initializeServiceSelect2&&initializeServiceSelect2()}),100)))})),window.previewImage=function(e){var o=new FileReader;o.onload=function(){e.target.closest(".form-group").querySelector("img").src=o.result;var t=e.target.closest(".form-group").querySelector(".btn-danger");t&&(t.style.display="inline-block")},o.readAsDataURL(e.target.files[0])},window.removeImage=function(){var e=event.target.closest(".form-group"),o=e.querySelector("img"),t=e.querySelector('input[type="file"]'),n=event.target;o.src="{{ default_feature_image() }}",t.value="",n.style.display="none"},window.initializeServiceSelect2=function(){console.log("üîß Initializing Select2 for service form dropdowns...");var e=$("#category_id"),o=$("#sub_category_id");if(console.log("üîç Checking elements:"),console.log("  - #category_id exists:",e.length>0),console.log("  - #category_id has Select2:",e.hasClass("select2-hidden-accessible")),console.log("  - #sub_category_id exists:",o.length>0),console.log("  - #sub_category_id has Select2:",o.hasClass("select2-hidden-accessible")),e.siblings(".select2-container").remove(),o.siblings(".select2-container").remove(),n("#category_id"),n("#sub_category_id"),n("#edit_category_id"),n("#edit_sub_category_id"),e.length){console.log("‚úÖ Reinitializing Select2 for #category_id");try{if(e.hasClass("select2-hidden-accessible")||e.data("select2")){console.log("üîÑ Destroying existing Select2 instance for #category_id");try{e.select2("destroy")}catch(o){e.removeData("select2"),e.removeClass("select2-hidden-accessible")}e.siblings(".select2-container").remove()}e.select2({placeholder:"Select Category",allowClear:!1,width:"100%",minimumResultsForSearch:1/0,dropdownParent:$("#form-offcanvas")}).on("select2:open",(function(){console.log("üìÇ Category dropdown opened"),e.siblings(".select2-container").not(":first").remove()})).on("select2:close",(function(){console.log("üìÇ Category dropdown closed")})).on("change",(function(){console.log("üìÇ Category changed:",$(this).val())})),e.addClass("select2-hidden-accessible"),setTimeout((function(){e.siblings(".select2-container").not(":first").remove()}),100),console.log("‚úÖ Select2 initialized successfully for #category_id")}catch(e){console.error("‚ùå Error initializing Select2 for #category_id:",e)}}else console.log("‚ö†Ô∏è #category_id element not found in DOM");if(o.length){console.log("‚úÖ Reinitializing Select2 for #sub_category_id");try{if(o.hasClass("select2-hidden-accessible")||o.data("select2")){console.log("üîÑ Destroying existing Select2 instance for #sub_category_id");try{o.select2("destroy")}catch(e){o.removeData("select2"),o.removeClass("select2-hidden-accessible")}o.siblings(".select2-container").remove()}o.select2({placeholder:"Select Subcategory",allowClear:!1,width:"100%",minimumResultsForSearch:1/0,dropdownParent:$("#form-offcanvas")}).on("select2:open",(function(){console.log("üìÇ Subcategory dropdown opened"),o.siblings(".select2-container").not(":first").remove()})).on("select2:close",(function(){console.log("üìÇ Subcategory dropdown closed")})).on("change",(function(){console.log("üìÇ Subcategory changed:",$(this).val())})),o.addClass("select2-hidden-accessible"),setTimeout((function(){o.siblings(".select2-container").not(":first").remove()}),100),console.log("‚úÖ Select2 initialized successfully for #sub_category_id")}catch(e){console.error("‚ùå Error initializing Select2 for #sub_category_id:",e)}}else console.log("‚ö†Ô∏è #sub_category_id element not found in DOM");var t=$("#form-offcanvas");$("#edit_category_id").length&&!$("#edit_category_id").hasClass("select2-hidden-accessible")&&$("#edit_category_id").select2({placeholder:"Select Category",allowClear:!1,width:"100%",minimumResultsForSearch:1/0,dropdownParent:t.length?t:$("body")}),$("#edit_sub_category_id").length&&!$("#edit_sub_category_id").hasClass("select2-hidden-accessible")&&$("#edit_sub_category_id").select2({placeholder:"Select Subcategory",allowClear:!1,width:"100%",minimumResultsForSearch:1/0,dropdownParent:t.length?t:$("body")})},window.changeCategory=function(e){console.log("üîÑ Category change handler triggered",e);var o=e.value;console.log("üìÇ Selected category ID:",o);var t=e.closest(".form-group"),n=t.parentNode.querySelector("#sub-category-group")||t.parentNode.querySelector("#edit-sub-category-group"),c=t.parentNode.querySelector("#sub_category_id")||t.parentNode.querySelector("#edit_sub_category_id");if(n&&c){var i=$(c);if(o){console.log("üì° Fetching subcategories for category:",o);var r=window.ServiceRoutes&&window.ServiceRoutes.getSubcategories?window.ServiceRoutes.getSubcategories:"/app/services/get-subcategories",s="".concat(r,"?category_id=").concat(o);console.log("üì° Fetch URL:",s),fetch(s).then((function(e){return e.json()})).then((function(e){console.log("‚úÖ Subcategories fetched:",e),i.empty(),i.append('<option value="">Select Subcategory</option>'),e.length>0?(e.forEach((function(e){i.append('<option value="'.concat(e.id,'">').concat(e.name,"</option>"))})),n.style.display="block",console.log("‚úÖ Subcategory dropdown populated with",e.length,"options")):(n.style.display="none",console.log("‚ÑπÔ∏è No subcategories found for this category")),i.trigger("change")})).catch((function(e){console.error("‚ùå Error fetching subcategories:",e),n.style.display="none"}))}else console.log("‚ÑπÔ∏è No category selected, hiding subcategory dropdown"),n.style.display="none"}else console.warn("‚ö†Ô∏è Subcategory group or select not found")}})();
//# sourceMappingURL=service-form.js.map