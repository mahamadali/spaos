{"version":3,"file":"/modules/service/service-form.js","mappings":"MACAA,SAASC,iBAAiB,oBAAoB,WAE5C,IAAMC,EAAcF,SAASG,eAAe,kBAEtCD,IACAA,EAAYD,iBAAiB,qBAAqB,WAC9CG,QAAQC,IAAI,qCAChB,IAEAH,EAAYD,iBAAiB,sBAAsB,WAC/CG,QAAQC,IAAI,oCAEZC,YAAW,WACPF,QAAQC,IAAI,uDACZ,IAAME,EAAaP,SAASG,eAAe,eACrCK,EAAgBR,SAASG,eAAe,mBAC9CC,QAAQC,IAAI,oCACZD,QAAQC,IAAI,2BAA4BE,EAAa,QAAU,aAC/DH,QAAQC,IAAI,+BAAgCG,EAAgB,QAAU,aAEvB,mBAApCC,OAAOC,0BACdN,QAAQC,IAAI,0CACZI,OAAOC,4BAEPN,QAAQO,KAAK,iDAErB,GAAG,KAGH,IAAMC,EAAmBZ,SAASG,eAAe,eAC3CU,EAAUb,SAASG,eAAe,uBACxC,GAAIS,GAAoBC,EAAS,KAGpBC,EAAT,WACI,IAAMC,EAAgBH,EAAiBI,MAAMC,OAC7CJ,EAAQK,YAAc,GAAHC,OAAMJ,EAAa,KAAAI,OAAIC,EAC9C,EALMA,EAAYR,EAAiBS,aAAa,cAAgB,IAOhET,EAAiBX,iBAAiB,QAASa,GAC3CA,GACJ,CACJ,KAINV,QAAQC,IAAI,0BACZiB,EAAEtB,UAAUuB,IAAI,QAAS,qBACzBD,EAAEtB,UAAUwB,GAAG,QAAS,qBAAqB,SAASC,GAClDA,EAAEC,iBACF,IAAMC,EAAYC,KAAKP,aAAa,oBAAsBO,KAAKP,aAAa,mBACvEM,GAoCX,SAAsBA,GAClBvB,QAAQC,IAAI,eAAgBsB,GAC5BE,EAAaF,EACRG,EAAUC,cAAc,mBAazBD,EAAUC,cAAc,mBAAmBC,UAAY,iOAZvDF,EAAUE,UAAY,4cAqB1B,IACMC,GADkBxB,OAAOyB,eAAiBzB,OAAOyB,cAAcC,SAAW1B,OAAOyB,cAAcC,SAAW,kCACzEC,QAAQ,SAAUT,GACzDU,MAAMJ,GACDK,MAAK,SAAAC,GAAQ,OAAIA,EAASC,MAAM,IAChCF,MAAK,SAAAG,GACFX,EAAUE,UAAYS,EAGNX,EAAUY,iBAAiB,UACnCC,SAAQ,SAAAC,GACZ,IAAMC,EAAY7C,SAAS8C,cAAc,UACzCC,MAAMC,KAAKJ,EAAUK,YAAYN,SAAQ,SAAAO,GACrCL,EAAUM,aAAaD,EAAKE,KAAMF,EAAKlC,MAC3C,IACA6B,EAAUQ,YAAYrD,SAASsD,eAAeV,EAAUZ,YACxDY,EAAUW,WAAWC,aAAaX,EAAWD,EACjD,IAGA5C,SAAS0C,iBAAiB,uBAAuBC,SAAQ,SAAAc,GAAE,OAAIA,EAAGC,QAAQ,IACtDC,UAAUC,UAAUC,oBAAoB/B,GAChDgC,OAEZxD,YAAW,WACiC,mBAA7BI,0BACPA,0BAER,GAAG,KACHN,QAAQC,IAAI,mCAChB,IAAE,OACK,SAAA0D,GACH3D,QAAQ2D,MAAM,2BAA4BA,GACtCjC,EAAUC,cAAc,qBACxBD,EAAUC,cAAc,mBAAmBC,UAAY,sHAI/D,GACR,CAlGMgC,CAAarC,EACjB,IAEE3B,SAASC,iBAAiB,UAAU,SAASwB,GACrB,iBAAhBA,EAAEwC,OAAOC,IAAyC,sBAAhBzC,EAAEwC,OAAOC,IAkGvD,SAA8BzC,GAC1B,IAAM0C,EAAO1C,EAAEwC,OACTG,EAAYD,EAAKpC,cAAc,yBAC/BsC,EAAUD,EAAUrC,cAAc,mBAExCqC,EAAUE,UAAW,EACjBD,GACAA,EAAQE,UAAUb,OAAO,SAGjC,CA3GYc,CAAqB/C,EAE7B,GACJ,IAGA,IAAMK,EAAY9B,SAAS+B,cAAc,mBACnC0C,EAAqB3C,EAAUE,UACjCH,EAAa,KA+HjB,SAAS6C,EAAmBC,GACxB,IAAMC,EAAMtD,EAAEqD,GACd,GAAIC,EAAI3D,QAAU2D,EAAIC,KAAK,WACvB,IACID,EAAIE,QAAQ,UAChB,CAAE,MAAMrD,GACJ,CAGZ,CAtIAzB,SAASC,iBAAiB,kBAAkB,SAAUwB,GAClD,IAAMsD,EAAStD,EAAEuD,OAAOC,QAEpBF,IAAWlD,IACfA,EAAakD,EAEA,IAAXA,GAA2B,MAAXA,IAEhBjD,EAAUE,UAAYyC,EAEtBnE,YAAW,WACiC,mBAA7BI,0BACPA,0BAER,GAAG,MAGT,IAmFAD,OAAOyE,aAAe,SAASC,GAC3B,IAAMC,EAAS,IAAIC,WACnBD,EAAOE,OAAS,WACIH,EAAMlB,OAAOsB,QAAQ,eAAexD,cAAc,OAC1DyD,IAAMJ,EAAOK,OACrB,IAAMC,EAAYP,EAAMlB,OAAOsB,QAAQ,eAAexD,cAAc,eAChE2D,IACAA,EAAUC,MAAMC,QAAU,eAElC,EACAR,EAAOS,cAAcV,EAAMlB,OAAO6B,MAAM,GAC5C,EAEArF,OAAOsF,YAAc,WACjB,IAAMC,EAAYb,MAAMlB,OAAOsB,QAAQ,eACjCU,EAAUD,EAAUjE,cAAc,OAClCmE,EAAYF,EAAUjE,cAAc,sBACpC2D,EAAYP,MAAMlB,OAExBgC,EAAQT,IAAM,gCACdU,EAAUlF,MAAQ,GAClB0E,EAAUC,MAAMC,QAAU,MAC9B,EAeAnF,OAAOC,yBAA2B,WAC9BN,QAAQC,IAAI,yDAEZ,IAAM8F,EAAc7E,EAAE,gBAChB8E,EAAiB9E,EAAE,oBAoBzB,GAlBAlB,QAAQC,IAAI,yBACZD,QAAQC,IAAI,2BAA4B8F,EAAYlF,OAAS,GAC7Db,QAAQC,IAAI,gCAAiC8F,EAAYE,SAAS,8BAClEjG,QAAQC,IAAI,+BAAgC+F,EAAenF,OAAS,GACpEb,QAAQC,IAAI,oCAAqC+F,EAAeC,SAAS,8BAGzEF,EAAYG,SAAS,sBAAsB5C,SAC3C0C,EAAeE,SAAS,sBAAsB5C,SAG9CgB,EAAmB,gBACnBA,EAAmB,oBACnBA,EAAmB,qBACnBA,EAAmB,yBAIfyB,EAAYlF,OAAQ,CACpBb,QAAQC,IAAI,6CACZ,IAEI,GAAI8F,EAAYE,SAAS,8BAAgCF,EAAYtB,KAAK,WAAY,CAClFzE,QAAQC,IAAI,4DACZ,IACI8F,EAAYrB,QAAQ,UACxB,CAAE,MAAMrD,GAEJ0E,EAAYI,WAAW,WACvBJ,EAAYK,YAAY,4BAC5B,CAEAL,EAAYG,SAAS,sBAAsB5C,QAC/C,CAGAyC,EAAYrB,QAAQ,CAChB2B,YAAa,kBACbC,YAAY,EACZC,MAAO,OACPC,wBAAyBC,IACzBC,eAAgBxF,EAAE,qBACnBE,GAAG,gBAAgB,WAClBpB,QAAQC,IAAI,+BAEZ8F,EAAYG,SAAS,sBAAsBS,IAAI,UAAUrD,QAC7D,IAAGlC,GAAG,iBAAiB,WACnBpB,QAAQC,IAAI,8BAChB,IAAGmB,GAAG,UAAU,WACZpB,QAAQC,IAAI,uBAAwBiB,EAAEM,MAAMoF,MAChD,IAGAb,EAAYc,SAAS,6BAErB3G,YAAW,WACP6F,EAAYG,SAAS,sBAAsBS,IAAI,UAAUrD,QAC7D,GAAG,KAEHtD,QAAQC,IAAI,sDAChB,CAAE,MAAMoB,GACJrB,QAAQ2D,MAAM,iDAAkDtC,EACpE,CACJ,MACIrB,QAAQC,IAAI,4CAKhB,GAAI+F,EAAenF,OAAQ,CACvBb,QAAQC,IAAI,iDACZ,IAEI,GAAI+F,EAAeC,SAAS,8BAAgCD,EAAevB,KAAK,WAAY,CACxFzE,QAAQC,IAAI,gEACZ,IACI+F,EAAetB,QAAQ,UAC3B,CAAE,MAAMrD,GAEJ2E,EAAeG,WAAW,WAC1BH,EAAeI,YAAY,4BAC/B,CAEAJ,EAAeE,SAAS,sBAAsB5C,QAClD,CAGA0C,EAAetB,QAAQ,CACnB2B,YAAa,qBACbC,YAAY,EACZC,MAAO,OACPC,wBAAyBC,IACzBC,eAAgBxF,EAAE,qBACnBE,GAAG,gBAAgB,WAClBpB,QAAQC,IAAI,kCAEZ+F,EAAeE,SAAS,sBAAsBS,IAAI,UAAUrD,QAChE,IAAGlC,GAAG,iBAAiB,WACnBpB,QAAQC,IAAI,iCAChB,IAAGmB,GAAG,UAAU,WACZpB,QAAQC,IAAI,0BAA2BiB,EAAEM,MAAMoF,MACnD,IAGAZ,EAAea,SAAS,6BAExB3G,YAAW,WACP8F,EAAeE,SAAS,sBAAsBS,IAAI,UAAUrD,QAChE,GAAG,KAEHtD,QAAQC,IAAI,0DAChB,CAAE,MAAMoB,GACJrB,QAAQ2D,MAAM,qDAAsDtC,EACxE,CACJ,MACIrB,QAAQC,IAAI,gDAIhB,IAAM6G,EAAgB5F,EAAE,mBACpBA,EAAE,qBAAqBL,SAAWK,EAAE,qBAAqB+E,SAAS,8BAClE/E,EAAE,qBAAqBwD,QAAQ,CAC3B2B,YAAa,kBACbC,YAAY,EACZC,MAAO,OACPC,wBAAyBC,IACzBC,eAAgBI,EAAcjG,OAASiG,EAAgB5F,EAAE,UAG7DA,EAAE,yBAAyBL,SAAWK,EAAE,yBAAyB+E,SAAS,8BAC1E/E,EAAE,yBAAyBwD,QAAQ,CAC/B2B,YAAa,qBACbC,YAAY,EACZC,MAAO,OACPC,wBAAyBC,IACzBC,eAAgBI,EAAcjG,OAASiG,EAAgB5F,EAAE,SAGrE,EAGAb,OAAO0G,eAAiB,SAASC,GAC7BhH,QAAQC,IAAI,uCAAwC+G,GACpD,IAAMC,EAAaD,EAAcpG,MACjCZ,QAAQC,IAAI,2BAA4BgH,GAExC,IAAMrB,EAAYoB,EAAc7B,QAAQ,eAClC+B,EAAmBtB,EAAUzC,WAAWxB,cAAc,wBACrCiE,EAAUzC,WAAWxB,cAAc,4BACpDwF,EAAoBvB,EAAUzC,WAAWxB,cAAc,qBACrCiE,EAAUzC,WAAWxB,cAAc,yBAE3D,GAAKuF,GAAqBC,EAA1B,CAKA,IAAMC,EAAqBlG,EAAEiG,GAE7B,GAAIF,EAAY,CACZjH,QAAQC,IAAI,0CAA2CgH,GAEvD,IAAMI,EAAchH,OAAOyB,eAAiBzB,OAAOyB,cAAcwF,iBAAoBjH,OAAOyB,cAAcwF,iBAAmB,kCACvHC,EAAY,GAAHxG,OAAMsG,EAAU,iBAAAtG,OAAgBkG,GAC/CjH,QAAQC,IAAI,gBAAiBsH,GAE7BtF,MAAMsF,GACDrF,MAAK,SAAAC,GAAQ,OAAIA,EAASqF,MAAM,IAChCtF,MAAK,SAAAuC,GACFzE,QAAQC,IAAI,2BAA4BwE,GACxC2C,EAAmBK,QACnBL,EAAmBM,OAAO,gDAEtBjD,EAAK5D,OAAS,GACd4D,EAAKlC,SAAQ,SAAAoF,GACTP,EAAmBM,OAAO,kBAAD3G,OAAmB4G,EAAY7D,GAAE,MAAA/C,OAAK4G,EAAY3E,KAAI,aACnF,IACAkE,EAAiB3B,MAAMC,QAAU,QACjCxF,QAAQC,IAAI,wCAAyCwE,EAAK5D,OAAQ,aAElEqG,EAAiB3B,MAAMC,QAAU,OACjCxF,QAAQC,IAAI,gDAGhBmH,EAAmBQ,QAAQ,SAC/B,IAAE,OACK,SAAAjE,GACH3D,QAAQ2D,MAAM,kCAAmCA,GACjDuD,EAAiB3B,MAAMC,QAAU,MACrC,GACR,MACIxF,QAAQC,IAAI,wDACZiH,EAAiB3B,MAAMC,QAAU,MArCrC,MAFIxF,QAAQO,KAAK,2CAyCrB,C","sources":["webpack:///./Modules/Service/Resources/assets/js/service-form.js"],"sourcesContent":["// Service Form JavaScript\ndocument.addEventListener('DOMContentLoaded', function() {\n\n  const offcanvasEl = document.getElementById('form-offcanvas');\n\n    if (offcanvasEl) {\n        offcanvasEl.addEventListener('show.bs.offcanvas', function() {\n            console.log('üîÑ Service offcanvas is opening...');\n        });\n        \n        offcanvasEl.addEventListener('shown.bs.offcanvas', function () {\n            console.log('‚úÖ Service offcanvas is now shown');\n            // Initialize Select2 when offcanvas is shown - increased delay to ensure DOM is ready\n            setTimeout(function() {\n                console.log('‚è±Ô∏è Timeout triggered, checking if elements exist...');\n                const categoryEl = document.getElementById('category_id');\n                const subCategoryEl = document.getElementById('sub_category_id');\n                console.log('üîç Elements check after timeout:');\n                console.log('  - category_id element:', categoryEl ? 'Found' : 'Not found');\n                console.log('  - sub_category_id element:', subCategoryEl ? 'Found' : 'Not found');\n                \n                if (typeof window.initializeServiceSelect2 === 'function') {\n                    console.log('üîß Calling initializeServiceSelect2...');\n                    window.initializeServiceSelect2();\n                } else {\n                    console.warn('‚ö†Ô∏è initializeServiceSelect2 function not found');\n                }\n            }, 300);\n            \n            // Handle description counter\n            const descriptionField = document.getElementById('description');\n            const counter = document.getElementById('description-counter');\n            if (descriptionField && counter) {\n                const maxLength = descriptionField.getAttribute('maxlength') || 250;\n\n                function updateCounter() {\n                    const currentLength = descriptionField.value.length;\n                    counter.textContent = `${currentLength}/${maxLength}`;\n                }\n\n                descriptionField.addEventListener('input', updateCounter);\n                updateCounter();\n            }\n        });\n    }\n\n  // Handle edit button clicks\n  console.log('service-form.js loaded');\n  $(document).off('click', '[data-service-id]');\n  $(document).on('click', '.edit-service-btn', function(e) {\n      e.preventDefault();\n      const serviceId = this.getAttribute('data-service-id') || this.getAttribute('data-service-id');\n      if (!serviceId) return;\n      loadEditForm(serviceId);\n  });\n    // Handle form submissions\n    document.addEventListener('submit', function(e) {\n        if (e.target.id === 'service-form' || e.target.id === 'service-edit-form') {\n            handleFormSubmission(e);\n        }\n    });\n});\n\n// Store original blank HTML from page load\nconst offcanvas = document.querySelector('#form-offcanvas');\nconst blankOffcanvasHTML = offcanvas.innerHTML;\nlet lastCrudId = null;\n\ndocument.addEventListener('crud_change_id', function (e) {\n    const formId = e.detail.form_id;\n    // Prevent repeated triggers for same ID\n    if (formId === lastCrudId) return;\n    lastCrudId = formId;\n\n  if (formId === 0 || formId === \"0\") {\n      // ==== NEW SERVICE ====\n      offcanvas.innerHTML = blankOffcanvasHTML;\n      // Initialize Select2 after form loads\n      setTimeout(function() {\n          if (typeof initializeServiceSelect2 === 'function') {\n              initializeServiceSelect2();\n          }\n      }, 100);\n      // Do NOT call show() here; the global offcanvas handler already shows it\n  }\n});\n\n\nfunction loadEditForm(serviceId) {\n    console.log('loadEditForm', serviceId);\n    lastCrudId = serviceId;\n    if (!offcanvas.querySelector('.offcanvas-body')) {\n        offcanvas.innerHTML = `\n            <div class=\"offcanvas-header\">\n                <h5 class=\"offcanvas-title\">Loading...</h5>\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"offcanvas\"></button>\n            </div>\n            <div class=\"offcanvas-body text-center\">\n                <div class=\"spinner-border\" role=\"status\">\n                    <span class=\"visually-hidden\">Loading...</span>\n                </div>\n            </div>\n        `;\n    } else {\n        offcanvas.querySelector('.offcanvas-body').innerHTML = `\n            <div class=\"text-center\">\n                <div class=\"spinner-border\" role=\"status\">\n                    <span class=\"visually-hidden\">Loading...</span>\n                </div>\n            </div>\n        `;\n    }\n\n    const editUrlTemplate = window.ServiceRoutes && window.ServiceRoutes.editForm ? window.ServiceRoutes.editForm : `/app/services/edit-form/__ID__`;\n    const editRequestUrl = editUrlTemplate.replace('__ID__', serviceId);\n    fetch(editRequestUrl)\n        .then(response => response.text())\n        .then(html => {\n            offcanvas.innerHTML = html;\n            \n            // Extract and execute scripts from the loaded HTML\n            const scripts = offcanvas.querySelectorAll('script');\n            scripts.forEach(oldScript => {\n                const newScript = document.createElement('script');\n                Array.from(oldScript.attributes).forEach(attr => {\n                    newScript.setAttribute(attr.name, attr.value);\n                });\n                newScript.appendChild(document.createTextNode(oldScript.innerHTML));\n                oldScript.parentNode.replaceChild(newScript, oldScript);\n            });\n            \n            // Clean up any stray backdrops before showing\n            document.querySelectorAll('.offcanvas-backdrop').forEach(el => el.remove());\n            const bsOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvas);\n            bsOffcanvas.show();\n            // Initialize Select2 after form loads\n            setTimeout(function() {\n                if (typeof initializeServiceSelect2 === 'function') {\n                    initializeServiceSelect2();\n                }\n            }, 100);\n            console.log('Offcanvas opened with edit form.');\n        })\n        .catch(error => {\n            console.error('Error loading edit form:', error);\n            if (offcanvas.querySelector('.offcanvas-body')) {\n                offcanvas.querySelector('.offcanvas-body').innerHTML = `\n                    <div class=\"alert alert-danger\">Error loading form. Please try again.</div>\n                `;\n            }\n        });\n}\n\n\n// Handle form submission\nfunction handleFormSubmission(e) {\n    const form = e.target;\n    const submitBtn = form.querySelector('button[type=\"submit\"]');\n    const spinner = submitBtn.querySelector('.spinner-border');\n\n    submitBtn.disabled = true;\n    if (spinner) {\n        spinner.classList.remove('d-none');\n    }\n\n}\n\n// Global functions for image preview\nwindow.previewImage = function(event) {\n    const reader = new FileReader();\n    reader.onload = function(){\n        const preview = event.target.closest('.form-group').querySelector('img');\n        preview.src = reader.result;\n        const removeBtn = event.target.closest('.form-group').querySelector('.btn-danger');\n        if (removeBtn) {\n            removeBtn.style.display = 'inline-block';\n        }\n    };\n    reader.readAsDataURL(event.target.files[0]);\n};\n\nwindow.removeImage = function() {\n    const formGroup = event.target.closest('.form-group');\n    const preview = formGroup.querySelector('img');\n    const fileInput = formGroup.querySelector('input[type=\"file\"]');\n    const removeBtn = event.target;\n\n    preview.src = '{{ default_feature_image() }}';\n    fileInput.value = '';\n    removeBtn.style.display = 'none';\n};\n\n// Helper function to safely destroy Select2 if it exists\nfunction safeDestroySelect2(selector) {\n    const $el = $(selector);\n    if ($el.length && $el.data('select2')) {\n        try {\n            $el.select2('destroy');\n        } catch(e) {\n            // Ignore errors if Select2 is not properly initialized\n        }\n    }\n}\n\n// Initialize Select2 for category dropdowns (used by service-form.js)\nwindow.initializeServiceSelect2 = function() {\n    console.log('üîß Initializing Select2 for service form dropdowns...');\n    \n    const $categoryId = $('#category_id');\n    const $subCategoryId = $('#sub_category_id');\n    \n    console.log('üîç Checking elements:');\n    console.log('  - #category_id exists:', $categoryId.length > 0);\n    console.log('  - #category_id has Select2:', $categoryId.hasClass('select2-hidden-accessible'));\n    console.log('  - #sub_category_id exists:', $subCategoryId.length > 0);\n    console.log('  - #sub_category_id has Select2:', $subCategoryId.hasClass('select2-hidden-accessible'));\n    \n    // Remove any duplicate Select2 containers first\n    $categoryId.siblings('.select2-container').remove();\n    $subCategoryId.siblings('.select2-container').remove();\n    \n    // Safely destroy existing Select2 instances first to avoid conflicts\n    safeDestroySelect2('#category_id');\n    safeDestroySelect2('#sub_category_id');\n    safeDestroySelect2('#edit_category_id');\n    safeDestroySelect2('#edit_sub_category_id');\n    \n    // Initialize Select2 for add form category dropdown\n    // Always destroy and reinitialize to ensure proper dropdownParent when offcanvas is shown\n    if ($categoryId.length) {\n        console.log('‚úÖ Reinitializing Select2 for #category_id');\n        try {\n            // Force destroy if it exists\n            if ($categoryId.hasClass('select2-hidden-accessible') || $categoryId.data('select2')) {\n                console.log('üîÑ Destroying existing Select2 instance for #category_id');\n                try {\n                    $categoryId.select2('destroy');\n                } catch(e) {\n                    // If destroy fails, remove data manually\n                    $categoryId.removeData('select2');\n                    $categoryId.removeClass('select2-hidden-accessible');\n                }\n                // Remove any leftover containers\n                $categoryId.siblings('.select2-container').remove();\n            }\n            \n            // Reinitialize with correct dropdownParent\n            $categoryId.select2({\n                placeholder: \"Select Category\",\n                allowClear: false,\n                width: '100%',\n                minimumResultsForSearch: Infinity,\n                dropdownParent: $('#form-offcanvas')\n            }).on('select2:open', function() {\n                console.log('üìÇ Category dropdown opened');\n                // Remove any duplicate containers after opening\n                $categoryId.siblings('.select2-container').not(':first').remove();\n            }).on('select2:close', function() {\n                console.log('üìÇ Category dropdown closed');\n            }).on('change', function() {\n                console.log('üìÇ Category changed:', $(this).val());\n            });\n            \n            // Ensure original select is hidden\n            $categoryId.addClass('select2-hidden-accessible');\n            // Remove any duplicate containers after initialization\n            setTimeout(function() {\n                $categoryId.siblings('.select2-container').not(':first').remove();\n            }, 100);\n            \n            console.log('‚úÖ Select2 initialized successfully for #category_id');\n        } catch(e) {\n            console.error('‚ùå Error initializing Select2 for #category_id:', e);\n        }\n    } else {\n        console.log('‚ö†Ô∏è #category_id element not found in DOM');\n    }\n    \n    // Initialize Select2 for add form subcategory dropdown\n    // Always destroy and reinitialize to ensure proper dropdownParent when offcanvas is shown\n    if ($subCategoryId.length) {\n        console.log('‚úÖ Reinitializing Select2 for #sub_category_id');\n        try {\n            // Force destroy if it exists\n            if ($subCategoryId.hasClass('select2-hidden-accessible') || $subCategoryId.data('select2')) {\n                console.log('üîÑ Destroying existing Select2 instance for #sub_category_id');\n                try {\n                    $subCategoryId.select2('destroy');\n                } catch(e) {\n                    // If destroy fails, remove data manually\n                    $subCategoryId.removeData('select2');\n                    $subCategoryId.removeClass('select2-hidden-accessible');\n                }\n                // Remove any leftover containers\n                $subCategoryId.siblings('.select2-container').remove();\n            }\n            \n            // Reinitialize with correct dropdownParent\n            $subCategoryId.select2({\n                placeholder: \"Select Subcategory\",\n                allowClear: false,\n                width: '100%',\n                minimumResultsForSearch: Infinity,\n                dropdownParent: $('#form-offcanvas')\n            }).on('select2:open', function() {\n                console.log('üìÇ Subcategory dropdown opened');\n                // Remove any duplicate containers after opening\n                $subCategoryId.siblings('.select2-container').not(':first').remove();\n            }).on('select2:close', function() {\n                console.log('üìÇ Subcategory dropdown closed');\n            }).on('change', function() {\n                console.log('üìÇ Subcategory changed:', $(this).val());\n            });\n            \n            // Ensure original select is hidden\n            $subCategoryId.addClass('select2-hidden-accessible');\n            // Remove any duplicate containers after initialization\n            setTimeout(function() {\n                $subCategoryId.siblings('.select2-container').not(':first').remove();\n            }, 100);\n            \n            console.log('‚úÖ Select2 initialized successfully for #sub_category_id');\n        } catch(e) {\n            console.error('‚ùå Error initializing Select2 for #sub_category_id:', e);\n        }\n    } else {\n        console.log('‚ö†Ô∏è #sub_category_id element not found in DOM');\n    }\n    \n    // Also initialize edit form dropdowns if they exist\n    const editOffcanvas = $('#form-offcanvas');\n    if ($('#edit_category_id').length && !$('#edit_category_id').hasClass('select2-hidden-accessible')) {\n        $('#edit_category_id').select2({\n            placeholder: \"Select Category\",\n            allowClear: false,\n            width: '100%',\n            minimumResultsForSearch: Infinity,\n            dropdownParent: editOffcanvas.length ? editOffcanvas : $('body')\n        });\n    }\n    if ($('#edit_sub_category_id').length && !$('#edit_sub_category_id').hasClass('select2-hidden-accessible')) {\n        $('#edit_sub_category_id').select2({\n            placeholder: \"Select Subcategory\",\n            allowClear: false,\n            width: '100%',\n            minimumResultsForSearch: Infinity,\n            dropdownParent: editOffcanvas.length ? editOffcanvas : $('body')\n        });\n    }\n};\n\n// Category change handler\nwindow.changeCategory = function(selectElement) {\n    console.log('üîÑ Category change handler triggered', selectElement);\n    const categoryId = selectElement.value;\n    console.log('üìÇ Selected category ID:', categoryId);\n    \n    const formGroup = selectElement.closest('.form-group');\n    const subCategoryGroup = formGroup.parentNode.querySelector('#sub-category-group') ||\n                           formGroup.parentNode.querySelector('#edit-sub-category-group');\n    const subCategorySelect = formGroup.parentNode.querySelector('#sub_category_id') ||\n                            formGroup.parentNode.querySelector('#edit_sub_category_id');\n\n    if (!subCategoryGroup || !subCategorySelect) {\n        console.warn('‚ö†Ô∏è Subcategory group or select not found');\n        return;\n    }\n\n    const $subCategorySelect = $(subCategorySelect);\n\n    if (categoryId) {\n        console.log('üì° Fetching subcategories for category:', categoryId);\n        // Fetch subcategories for the selected category\n        const subcatBase = (window.ServiceRoutes && window.ServiceRoutes.getSubcategories) ? window.ServiceRoutes.getSubcategories : '/app/services/get-subcategories';\n        const subcatUrl = `${subcatBase}?category_id=${categoryId}`;\n        console.log('üì° Fetch URL:', subcatUrl);\n        \n        fetch(subcatUrl)\n            .then(response => response.json())\n            .then(data => {\n                console.log('‚úÖ Subcategories fetched:', data);\n                $subCategorySelect.empty();\n                $subCategorySelect.append('<option value=\"\">Select Subcategory</option>');\n\n                if (data.length > 0) {\n                    data.forEach(subcategory => {\n                        $subCategorySelect.append(`<option value=\"${subcategory.id}\">${subcategory.name}</option>`);\n                    });\n                    subCategoryGroup.style.display = 'block';\n                    console.log('‚úÖ Subcategory dropdown populated with', data.length, 'options');\n                } else {\n                    subCategoryGroup.style.display = 'none';\n                    console.log('‚ÑπÔ∏è No subcategories found for this category');\n                }\n                // Update Select2\n                $subCategorySelect.trigger('change');\n            })\n            .catch(error => {\n                console.error('‚ùå Error fetching subcategories:', error);\n                subCategoryGroup.style.display = 'none';\n            });\n    } else {\n        console.log('‚ÑπÔ∏è No category selected, hiding subcategory dropdown');\n        subCategoryGroup.style.display = 'none';\n    }\n};"],"names":["document","addEventListener","offcanvasEl","getElementById","console","log","setTimeout","categoryEl","subCategoryEl","window","initializeServiceSelect2","warn","descriptionField","counter","updateCounter","currentLength","value","length","textContent","concat","maxLength","getAttribute","$","off","on","e","preventDefault","serviceId","this","lastCrudId","offcanvas","querySelector","innerHTML","editRequestUrl","ServiceRoutes","editForm","replace","fetch","then","response","text","html","querySelectorAll","forEach","oldScript","newScript","createElement","Array","from","attributes","attr","setAttribute","name","appendChild","createTextNode","parentNode","replaceChild","el","remove","bootstrap","Offcanvas","getOrCreateInstance","show","error","loadEditForm","target","id","form","submitBtn","spinner","disabled","classList","handleFormSubmission","blankOffcanvasHTML","safeDestroySelect2","selector","$el","data","select2","formId","detail","form_id","previewImage","event","reader","FileReader","onload","closest","src","result","removeBtn","style","display","readAsDataURL","files","removeImage","formGroup","preview","fileInput","$categoryId","$subCategoryId","hasClass","siblings","removeData","removeClass","placeholder","allowClear","width","minimumResultsForSearch","Infinity","dropdownParent","not","val","addClass","editOffcanvas","changeCategory","selectElement","categoryId","subCategoryGroup","subCategorySelect","$subCategorySelect","subcatBase","getSubcategories","subcatUrl","json","empty","append","subcategory","trigger"],"sourceRoot":""}